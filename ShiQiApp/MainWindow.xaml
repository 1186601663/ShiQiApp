<hc:Window x:Class="ShiQiApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:local="clr-namespace:ShiQiApp" d:DataContext="{d:DesignInstance Type=local:MainViewModel}"
           mc:Ignorable="d"
        Style="{StaticResource WindowW10}">
    <Grid>
        <Grid.ColumnDefinitions>
            <!-- 动态宽度：展开时 200，折叠时 50 -->
            <ColumnDefinition Width="{Binding IsNavigationExpanded, 
                Converter={StaticResource BoolToWidthConverter}, 
                FallbackValue=200}" />
            <ColumnDefinition Width="1" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- 左侧导航栏 -->
        <Border Grid.Column="0" Background="#FFF0F0F0" Padding="10">
            <StackPanel>
                <!-- 标题 & 折叠按钮 -->
                <Grid Height="32">
                    <TextBlock Text="导航" 
                               FontWeight="Bold" 
                               Visibility="{Binding IsNavigationExpanded, Converter={StaticResource BoolToVisConverter}}"/>

                    <!-- 折叠/展开按钮 -->
                    <Button Content="{Binding IsNavigationExpanded, Converter={StaticResource ExpandCollapseConverter}}"
                            Command="{Binding ToggleNavigationCommand}"
                            HorizontalAlignment="Right"
                            Width="24" Height="24"
                            ToolTip="折叠/展开导航栏"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"/>
                </Grid>

                <Separator Margin="0,5"/>

                <!-- 导航列表 -->
                <ListBox ItemsSource="{Binding NavigationItems}"
                         SelectedItem="{Binding SelectedNavigationItem}"
                         BorderThickness="0"
                         Background="Transparent"
                         ItemContainerStyle="{StaticResource NavButtonStyle}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="5">
                                <!-- 图标 -->
                                <TextBlock x:Name="icon" 
                                           Text="{Binding IconGlyph}" 
                                           FontFamily="Segoe MDL2 Assets"
                                           FontSize="16"
                                           VerticalAlignment="Center"
                                           Margin="0,0,10,0"/>

                                <!-- 文字（仅在展开时显示） -->
                                <TextBlock Text="{Binding DisplayName}" 
                                           FontSize="14"
                                           VerticalAlignment="Center"
                                           Visibility="{Binding DataContext.IsNavigationExpanded, 
                                               RelativeSource={RelativeSource AncestorType=ListBox},
                                               Converter={StaticResource BoolToVisConverter}}"/>
                            </Grid>

                            <!-- 折叠时显示 Tooltip -->
                            <DataTemplate.Triggers>
                                <DataTrigger Binding="{Binding DataContext.IsNavigationExpanded, 
                                    RelativeSource={RelativeSource AncestorType=ListBox}}" Value="False">
                                    <Setter TargetName="icon" Property="ToolTip" Value="{Binding DisplayName}"/>
                                    <Setter TargetName="icon" Property="ToolTip.Style" Value="{StaticResource CollapsedNavTooltip}"/>
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
        </Border>

        <!-- 分割线 -->
        <Rectangle Grid.Column="1" Fill="#FFCCCCCC"/>

        <!-- 主内容区 -->
        <Grid Grid.Column="2" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <Button Content="🔄 Reload Modules" 
                        Command="{Binding LoadModulesCommand}" 
                        Padding="10,5"/>
                <TextBlock Text="{Binding Status}" 
                           VerticalAlignment="Center" 
                           Margin="10,0,0,0"/>
            </StackPanel>

            <ContentControl Grid.Row="1" 
                            Content="{Binding CurrentView}"
                            HorizontalContentAlignment="Stretch"
                            VerticalContentAlignment="Stretch"/>
        </Grid>
    </Grid>
</hc:Window>
